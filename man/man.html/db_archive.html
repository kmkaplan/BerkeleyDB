<HTML>
<HEAD>
<TITLE>db_archive</TITLE>
</HEAD>
<BODY>
<H1>db_archive</H1>
<HR>
<PRE>

</PRE>
<H2>NAME</H2><PRE>
       db_archive - the DB database archiver


</PRE>
<H2>SYNOPSIS</H2><PRE>
       <STRONG>db_archive</STRONG> [<STRONG>-alsv</STRONG>] [<STRONG>-h</STRONG> <STRONG>home</STRONG>]


</PRE>
<H2>DESCRIPTION</H2><PRE>
       The  <EM>db</EM><STRONG>_</STRONG><EM>archive</EM>  utility writes the pathnames of log files
       that are no longer in use (e.g.,  no  longer  involved  in
       active transactions), to the standard output, one pathname
       per line.  These log files should  be  written  to  backup
       media  to provide for recovery in the case of catastrophic
       failure (which also requires a snapshot  of  the  database
       files),  but  they  may then be deleted from the system to
       reclaim disk space.

       The options are as follows:

       <STRONG>-a</STRONG>   Write all pathnames as absolute pathnames, instead of
            relative to the database home directories.

       <STRONG>-h</STRONG>   Specify a home directory for the database.

       <STRONG>-l</STRONG>   Write  out  the  pathnames of all of the database log
            files, whether or not they  are  involved  in  active
            transactions.

       <STRONG>-s</STRONG>   Write the pathnames of all of the database files that
            need to be archived in order to recover the  database
            from  catastrophic  failure.   If any of the database
            files have not been accessed during the  lifetime  of
            the  current  log  files, <EM>db</EM><STRONG>_</STRONG><EM>archive</EM> will not include
            them in this output.

            It is possible that some of the files  referenced  in
            the  log have since been deleted from the system.  In
            this  case,  <EM>db</EM><STRONG>_</STRONG><EM>archive</EM>  will  ignore   them.    When
            <STRONG><A HREF="db_recover.html">db_recover(1)</A></STRONG> is run, any files referenced in the log
            that are not present during recovery are  assumed  to
            have been deleted and will not be recovered.

       <STRONG>-v</STRONG>   Run  in  verbose mode, listing the checkpoints in the
            log files as they are reviewed.

       The  <EM>db</EM><STRONG>_</STRONG><EM>archive</EM>  utility  attaches  to  DB  shared  memory
       regions.   In  order to avoid region corruption, it should
       always be given the chance to detach and exit  gracefully.
       To  cause  <EM>db</EM><STRONG>_</STRONG><EM>archive</EM>  to  clean up after itself and exit,
       send it an interrupt signal (SIGINT).

       The <EM>db</EM><STRONG>_</STRONG><EM>archive</EM> utility exits 0 on success, and  &gt;0  if  an
       error occurs.


       recover from catastrophic  failure,  the  following  steps
       should be taken:

       1.   Run  <EM>db</EM><STRONG>_</STRONG><EM>archive</EM>  -s  to  identify all of the database
            data files that must be saved, and  copy  them  to  a
            backup  device,  (e.g., tape).  If the database files
            are stored in a separate  directory  from  the  other
            database  files,  it  may  be  simpler to archive the
            directory itself instead of the individual files.

            <STRONG>More</STRONG> <STRONG>importantly,</STRONG> <STRONG>if</STRONG> <STRONG>any</STRONG> <STRONG>of</STRONG> <STRONG>the</STRONG> <STRONG>database</STRONG>  <STRONG>files</STRONG>  <STRONG>have</STRONG>
            <STRONG>not</STRONG>  <STRONG>been</STRONG> <STRONG>accessed</STRONG> <STRONG>during</STRONG> <STRONG>the</STRONG> <STRONG>lifetime</STRONG> <STRONG>of</STRONG> <STRONG>the</STRONG> <STRONG>current</STRONG>
            <STRONG>log</STRONG> <STRONG>files,</STRONG> <STRONG>db_archive</STRONG> <STRONG>will</STRONG> <STRONG>not</STRONG> <STRONG>list</STRONG> <STRONG>them</STRONG> <STRONG>in</STRONG> <STRONG>its</STRONG>  <STRONG>out-</STRONG>
            <STRONG>put!</STRONG>   For  this reason, it may be important to use a
            separate  database  file  directory,   archiving   it
            instead of the files listed by <EM>db</EM><STRONG>_</STRONG><EM>archive</EM>.

       2.   If  your  database is currently active, i.e., you are
            reading and writing to the database files  while  the
            snapshot  is  being taken, run <EM>db</EM><STRONG>_</STRONG><EM>archive</EM> -l to iden-
            tify the database log  files,  and  copy  them  to  a
            backup  device,  (e.g.,  tape).   If the database log
            files are stored in a  separate  directory  from  the
            other  database  files,  it may be simpler to archive
            the directory itself instead of the individual files.

       Note  that the order of these operations is important, and
       that the database files <STRONG>must</STRONG> be archived  before  the  log
       files.

       The  DB  library  supports  on-line backups, and it is not
       necessary to stop reading or writing your databases during
       the  time  when  you  create this snapshot.  Note however,
       that the snapshot of an active database will be consistent
       as  of  some  unspecified  time  between  the start of the
       archival and when archival  is  completed.   To  create  a
       snapshot  as of a specific time, you must stop reading and
       writing  your  databases  for  the  entire  time  of   the
       archival,  in  which  case the log files do not need to be
       archived.

       Once these steps  are  completed,  your  database  can  be
       recovered from catastrophic failure to its state as of the
       time the archival was done.  To update  your  snapshot  so
       that  recovery from catastrophic failure is possible up to
       a new point in time, repeat step #2, copying all  existing
       log files to a backup device.

       Each  time  that  a  complete  snapshot  is made, i.e. all
       database and log files are copied to backup media, you may
       discard all previous snapshots and saved log files.

       The  time  to restore from catastrophic failure is a func-
       tion of the number of log records that have  been  written
       following steps should be taken:

       1.   Restore  the  copies  of  the database files from the
            backup media.

       2.   Restore the copies of the log files from  the  backup
            media,  <STRONG>in</STRONG>  <STRONG>the</STRONG>  <STRONG>order</STRONG>  <STRONG>in</STRONG>  <STRONG>which</STRONG>  <STRONG>they</STRONG> <STRONG>were</STRONG> <STRONG>written</STRONG>.
            (It's possible that the same log file appears on mul-
            tiple backups, and you only want the most recent ver-
            sion of that log file!)

       3.   Run <EM>db</EM><STRONG>_</STRONG><EM>recover</EM> -c to recover the database.

       It is possible to recreate the database in a location dif-
       ferent  than the original, by specifying appropriate path-
       names to the -h option of the <EM>db</EM><STRONG>_</STRONG><EM>recover</EM> utility.

       To remove log files, the following steps should be taken:

       1.   If you are concerned with catastrophic failure, first
            copy  them to backup media (e.g., tape), as described
            above.  This is because log files are  necessary  for
            recovery from catastrophic failure.

       2.   Run  <EM>db</EM><STRONG>_</STRONG><EM>archive</EM>,  without options, to identify all of
            the log files  that  are  no  longer  in  use  (e.g.,
            involved in an active transaction).

       3.   Remove those log files from the system.


</PRE>
<H2>ENVIRONMENT VARIABLES</H2><PRE>
       The  following  environment variables affect the execution
       of <EM>db</EM><STRONG>_</STRONG><EM>archive</EM>:

       DB_HOME
            If the <STRONG>-h</STRONG> option is not specified and the environment
            variable  <EM>DB</EM><STRONG>_</STRONG><EM>HOME</EM>  is  set, it is used as the path of
            the database home, as described in <STRONG><A HREF="db_appinit.html">db_appinit(3)</A></STRONG>.


</PRE>
<H2>SEE ALSO</H2><PRE>
       The DB library is a family of  groups  of  functions  that
       provides  a  modular programming interface to transactions
       and record-oriented file  access.   The  library  includes
       support  for  transactions, locking, logging and file page
       caching, as well as various indexed access methods.   Many
       of  the  functional  groups  (e.g.,  the file page caching
       functions) are useful independent of the  other  DB  func-
       tions,  although  some  functional  groups  are explicitly
       based on other functional groups (e.g.,  transactions  and
       logging).   For  a  general description of the DB package,
       see <STRONG><A HREF="db_intro.html">db_intro(3)</A></STRONG>.

       <STRONG><A HREF="db_archive.html">db_archive(1)</A></STRONG>, <STRONG><A HREF="db_checkpoint.html">db_checkpoint(1)</A></STRONG>, <STRONG><A HREF="db_deadlock.html">db_deadlock(1)</A></STRONG>, <STRONG><A HREF="db_dump.html">db_dump(1)</A></STRONG>,
       <STRONG><A HREF="db_load.html">db_load(1)</A></STRONG>, <STRONG><A HREF="db_recover.html">db_recover(1)</A></STRONG>, <STRONG><A HREF="db_stat.html">db_stat(1)</A></STRONG>, <STRONG><A HREF="db_intro.html">db_intro(3)</A></STRONG>,
</PRE>
</BODY>
</HTML>
