<HTML>
<HEAD>
<TITLE>DbMpoolFile</TITLE>
</HEAD>
<BODY>
<H1>DbMpoolFile</H1>
<HR>
<PRE>

</PRE>
<H2>NAME</H2><PRE>
       DbMpoolFile - shared memory buffer pool


</PRE>
<H2>SYNOPSIS</H2><PRE>
       <STRONG>#include</STRONG> <STRONG>&lt;db_cxx.h&gt;</STRONG>

       <STRONG>static</STRONG> <STRONG>int</STRONG>
       <STRONG>DbMpoolFile::open(DbMpool</STRONG> <STRONG>*mp,</STRONG> <STRONG>char</STRONG> <STRONG>*file,</STRONG> <STRONG>int</STRONG> <STRONG>ftype,</STRONG> <STRONG>int</STRONG> <STRONG>flags,</STRONG>
            <STRONG>int</STRONG> <STRONG>mode,</STRONG> <STRONG>size_t</STRONG> <STRONG>pagesize,</STRONG> <STRONG>int</STRONG> <STRONG>lsn_offset,</STRONG> <STRONG>Dbt</STRONG> <STRONG>*pgcookie,</STRONG>
            <STRONG>u_int8_t</STRONG> <STRONG>*uid,</STRONG> <STRONG>DbMpoolFile</STRONG> <STRONG>**mpf);</STRONG>

       <STRONG>int</STRONG>
       <STRONG>DbMpoolFile::close();</STRONG>

       <STRONG>int</STRONG>
       <STRONG>DbMpoolFile::get(db_pgno_t</STRONG> <STRONG>*pgnoaddr,</STRONG> <STRONG>int</STRONG> <STRONG>flags,</STRONG> <STRONG>void</STRONG> <STRONG>**pagep);</STRONG>

       <STRONG>int</STRONG>
       <STRONG>DbMpoolFile::put(void</STRONG> <STRONG>*pgaddr,</STRONG> <STRONG>int</STRONG> <STRONG>flags);</STRONG>

       <STRONG>int</STRONG>
       <STRONG>DbMpoolFile::set(void</STRONG> <STRONG>*pgaddr,</STRONG> <STRONG>int</STRONG> <STRONG>flags);</STRONG>

       <STRONG>int</STRONG>
       <STRONG>DbMpoolFile::sync();</STRONG>


</PRE>
<H2>DESCRIPTION</H2><PRE>
       The DB library is a family of classes that provides a mod-
       ular programming interface to transactions and record-ori-
       ented  file  access.   The  library  includes  support for
       transactions, locking, logging and file page  caching,  as
       well  as  various  indexed  access  methods.   Many of the
       classes (e.g., the file page  caching  class)  are  useful
       independent of the other DB classes, although some classes
       are explicitly based on other classes (e.g.,  transactions
       and  logging).   For a general description of the DB pack-
       age, see <STRONG><A HREF="db_intro.html">db_intro(3)</A></STRONG>.

       This manual page describes the  specific  details  of  the
       per-file memory pool interface.

       The  <STRONG><A HREF="DbMpool.html">DbMpool(3)</A></STRONG> and <STRONG><A HREF="DbMpoolFile.html">DbMpoolFile(3)</A></STRONG> classes are the library
       interface intended to provide  general-purpose,  page-ori-
       ented  buffer  management  of  one  or  more files.  While
       designed to work with the other Db functions, these  func-
       tions are also useful for more general purposes.  The mem-
       ory pools (<EM>DbMpool::</EM>'s) are referred to in  this  document
       as  simply  ``pools''.   Pools  may be shared between pro-
       cesses.  Pools are usually filled by  pages  from  one  or
       more   files  (<EM>DbMpoolFile</EM>'s).   Pages  in  the  pool  are
       replaced in LRU (least-recently-used) order, with each new
       page  replacing the page that has been unused the longest.
       Pages retrieved from the pool using  <EM>DbMpoolFile::get</EM>  are
       ``pinned''  in  the  pool,  by  default,  until  they  are

       The <EM>ftype</EM> argument should be the same as a <EM>ftype</EM>  argument
       previously  specified  to the <EM>DbMpool::db</EM><STRONG>_</STRONG><EM>register</EM> method,
       unless no input or output processing of the  file's  pages
       are  necessary,  in  which  case it should be 0.  (See the
       description of the <EM>DbMpool::db</EM><STRONG>_</STRONG><EM>register</EM>  method  for  more
       information.)

       The  <EM>flags</EM>  and  <EM>mode</EM>  arguments specify how files will be
       opened and/or created when they don't already exist.   The
       flags value is specified by <STRONG>or</STRONG>'ing together one or more of
       the following values:

       DB_CREATE
            Create any underlying files, as  necessary.   If  the
            files  do not already exist and the DB_CREATE flag is
            not specified, the call will fail.

       DB_NOMMAP
            Always copy this file into the local cache instead of
            mapping  it  into process memory (see the description
            of the <EM>mp</EM><STRONG>_</STRONG><EM>mmapsize</EM> field of the DbEnv object for fur-
            ther information).

       DB_RDONLY
            Open  any  underlying  files  for  reading only.  Any
            attempt to write the file using  the  pool  functions
            will  fail,  regardless  of the actual permissions of
            the file.

       All files created by the method <EM>DbMpoolFile::open</EM> are cre-
       ated  with  mode <EM>mode</EM> (as described in <STRONG><A HREF="chmod.html">chmod(2)</A></STRONG>) and modi-
       fied by the process' umask value at the time  of  creation
       (see  <STRONG><A HREF="umask.html">umask(2)</A></STRONG>).   The group ownership of created files is
       based on the system and directory  defaults,  and  is  not
       further specified by DB.

       The  <EM>pagesize</EM>  argument is the size, in bytes, of the unit
       of transfer between the application and the pool, although
       it  is  not  necessarily  the unit of transfer between the
       pool and the source file.


       The <EM>lsn</EM><STRONG>_</STRONG><EM>offset</EM> argument is the zero-based byte  offset  in
       the page of the page's log sequence number (LSN), or -1 if
       no LSN offset is specified.  (See the description  of  the
       <EM>DbMpool::sync</EM> method for more information.)

       The  <EM>pgcookie</EM>  argument  contains  the byte string that is
       passed to the <EM>pgin</EM> and <EM>pgout</EM> functions for this  file,  if
       any.   (See  the  description  of the <EM>DbMpool::db</EM><STRONG>_</STRONG><EM>register</EM>
       method for more information.)

       The <EM>uid</EM> argument is a unique identifier for the file.  The
       provide  the  same unique identifier.  If the <EM>uid</EM> argument
       is  non-NULL,  it  must  reference  a  DB_FILE_ID_LEN  (as
       defined  in &lt;db_cxx.h&gt;) length array of bytes that will be
       used to uniquely identify the file.  This  should  not  be
       necessary  for most applications.  Specifically, it is not
       necessary if the memory pool is re-instantiated after each
       system  reboot,  the  application  is  using the Db access
       methods instead of calling the pool functions  explicitly,
       or  the files in the memory pool are stored on filesystems
       where the file device and  inode  numbers  do  not  change
       across system reboots.

       The  <EM>DbMpoolFile::open</EM>  method  throws a <STRONG><A HREF="DbException.html">DbException(3)</A></STRONG> or
       returns the value of <EM>errno</EM> on failure and 0 on success.

  <EM>DbMpoolFile::close</EM>
       The <EM>DbMpoolFile::close</EM> method closes the source file indi-
       cated  by  the  DbMpoolFile  object.  This method does not
       imply a call to <EM>DbMpoolFile::sync</EM>, i.e. no pages are writ-
       ten  to  the  source  file  as as a result of calling <EM>DbM-</EM>
       <EM>poolFile::close</EM>.

       In addition, if the <EM>file</EM> argument to <EM>DbMpoolFile::open</EM> was
       NULL,  any  underlying  files created for this DbMpoolFile
       will be removed.

       The <EM>DbMpoolFile::close</EM> method throws a  <STRONG><A HREF="DbException.html">DbException(3)</A></STRONG>  or
       returns the value of <EM>errno</EM> on failure and 0 on success.

  <EM>DbMpoolFile::get</EM>
       The  <EM>DbMpoolFile::get</EM>  method copies a pointer to the page
       with the page  number  specified  by  <EM>pgnoaddr</EM>,  from  the
       source  file  specified by the DbMpoolFile object into the
       memory location referenced by <EM>pagep</EM>.  If the page does not
       exist  or cannot be retrieved, <EM>DbMpoolFile::get</EM> will fail.

       The returned page is size_t type aligned.

       <STRONG>Page</STRONG> <STRONG>numbers</STRONG> <STRONG>begin</STRONG> <STRONG>at</STRONG> <STRONG>0,</STRONG> <STRONG>e.g.,</STRONG> <STRONG>the</STRONG> <STRONG>first</STRONG> <STRONG>page</STRONG> <STRONG>in</STRONG> <STRONG>the</STRONG>  <STRONG>file</STRONG>
       <STRONG>is</STRONG> <STRONG>page</STRONG> <STRONG>number</STRONG> <STRONG>0,</STRONG> <STRONG>not</STRONG> <STRONG>page</STRONG> <STRONG>number</STRONG> <STRONG>1.</STRONG>

       The  <EM>flags</EM> argument is specified by <STRONG>or</STRONG>'ing together one or
       more of the following values:

       DB_MPOOL_CREATE
            If the specified page does not exist, create it.   In
            this  case, the <EM>pgin</EM> method, if specified, is called.

       DB_MPOOL_LAST
            Return the last page of the source file and copy  its
            page number to the location referenced by <EM>pgnoaddr</EM>.

       DB_MPOOL_NEW
            Create  a new page in the file and copy its page num-

       The <EM>DbMpoolFile::get</EM> method  throws  a  <STRONG><A HREF="DbException.html">DbException(3)</A></STRONG>  or
       returns the value of <EM>errno</EM> on failure and 0 on success.

  <EM>DbMpoolFile::put</EM>
       The <EM>DbMpoolFile::put</EM> method indicates that the page refer-
       enced by <EM>pgaddr</EM> can be evicted from the pool.  <EM>Pgaddr</EM> must
       be an address previously returned by <EM>DbMpoolFile::get</EM>.

       The  <EM>flags</EM> argument is specified by <STRONG>or</STRONG>'ing together one or
       more of the following values:

       DB_MPOOL_CLEAN
            Clear any  previously  set  modification  information
            (i.e.,  don't  bother  writing  the  page back to the
            source file).

       DB_MPOOL_DIRTY
            The page has been modified and must be written to the
            source file before being evicted from the pool.
       DB_MPOOL_DISCARD
            The page is unlikely to be useful in the near future,
            and should be discarded before  other  pages  in  the
            pool.

       The  DB_MPOOL_CLEAN  and DB_MPOOL_DIRTY flags are mutually
       exclusive.

       The <EM>DbMpoolFile::put</EM> method  throws  a  <STRONG><A HREF="DbException.html">DbException(3)</A></STRONG>  or
       returns the value of <EM>errno</EM> on failure and 0 on success.

  <EM>DbMpoolFile::set</EM>
       The <EM>DbMpoolFile::set</EM> method sets the flags associated with
       the page referenced by <EM>pgaddr</EM> without  unpinning  it  from
       the  pool.   <EM>Pgaddr</EM> must be an address previously returned
       by  <EM>DbMpoolFile::get</EM>.   The   <EM>flags</EM>   argument   to   <EM>DbM-</EM>
       <EM>poolFile::set</EM>  is specified by <STRONG>or</STRONG>'ing together one or more
       of the values specified as flags for the  <EM>DbMpoolFile::put</EM>
       call.

       The  <EM>DbMpoolFile::set</EM>  method  throws  a <STRONG><A HREF="DbException.html">DbException(3)</A></STRONG> or
       returns the value of <EM>errno</EM> on failure and 0 on success.

  <EM>DbMpoolFile::sync</EM>
       The <EM>DbMpoolFile::sync</EM> method writes all  pages  associated
       with  the  DbMpoolFile object that were marked as modified
       using <EM>DbMpoolFile::put</EM> or <EM>DbMpoolFile::set</EM>,  back  to  the
       source file.  If any of the modified pages are also pinned
       (i.e., currently referenced by this  or  another  process)
       <EM>DbMpoolFile::sync</EM> will ignore them.

       The  <EM>DbMpoolFile::sync</EM>  method  throws a <STRONG><A HREF="DbException.html">DbException(3)</A></STRONG> or
       returns the value of <EM>errno</EM> on failure, 0 on  success,  and
       DB_INCOMPLETE  if there were pages which were modified but
       which <EM>DbMpoolFile::sync</EM> was unable to write.
       <STRONG><A HREF="mmap.html">mmap(2)</A></STRONG>, <STRONG><A HREF="open.html">open(2)</A></STRONG>, <STRONG><A HREF="sigfillset.html">sigfillset(3)</A></STRONG>, <STRONG><A HREF="sigprocmask.html">sigprocmask(2)</A></STRONG>, <STRONG><A HREF="stat.html">stat(2)</A></STRONG>,
       <STRONG><A HREF="strcpy.html">strcpy(3)</A></STRONG>, <STRONG><A HREF="strdup.html">strdup(3)</A></STRONG>, <STRONG><A HREF="strerror.html">strerror(3)</A></STRONG>, <STRONG><A HREF="strlen.html">strlen(3)</A></STRONG>, <STRONG><A HREF="time.html">time(3)</A></STRONG>,
       <STRONG><A HREF="unlink.html">unlink(2)</A></STRONG>, and <STRONG><A HREF="write.html">write(2)</A></STRONG>.

       In  addition,  the  <EM>DbMpoolFile::open</EM>  method may fail and
       throw a <STRONG><A HREF="DbException.html">DbException(3)</A></STRONG> or return <EM>errno</EM> for  the  following
       conditions:
       [EINVAL]
            An invalid flag value or parameter was specified.

            The  file has already been entered into the pool, and
            the <EM>pagesize</EM> value is not the same as when  the  file
            was  entered into the pool, or the length of the file
            is not zero or a multiple of the <EM>pagesize</EM>.

            The DB_RDONLY flag was  specified  for  an  in-memory
            pool.

       The  <EM>DbMpoolFile::close</EM>  method may fail and throw a <EM>DbEx-</EM>
       <STRONG><A HREF="ception.html">ception(3)</A></STRONG> or return <EM>errno</EM> for any of the errors specified
       for the following DB and library functions: <STRONG><A HREF="close.html">close(2)</A></STRONG>,
       <STRONG><A HREF="fcntl.html">fcntl(2)</A></STRONG>, <STRONG><A HREF="fflush.html">fflush(3)</A></STRONG>, <STRONG><A HREF="munmap.html">munmap(2)</A></STRONG>, and <STRONG><A HREF="strerror.html">strerror(3)</A></STRONG>.

       The <EM>DbMpoolFile::get</EM> method may fail and throw a  <EM>DbExcep-</EM>
       <STRONG><A HREF="tion.html">tion(3)</A></STRONG>  or  return  <EM>errno</EM> for any of the errors specified
       for the following DB and library functions:
       DBmemp-&gt;<STRONG><A HREF="pgin.html">pgin(3)</A></STRONG>, DBmemp-&gt;<STRONG><A HREF="pgout.html">pgout(3)</A></STRONG>, DbLog::<STRONG><A HREF="compare.html">compare(3)</A></STRONG>,
       DbLog::<STRONG><A HREF="flush.html">flush(3)</A></STRONG>, <STRONG><A HREF="close.html">close(2)</A></STRONG>, <STRONG><A HREF="fcntl.html">fcntl(2)</A></STRONG>, <STRONG><A HREF="fflush.html">fflush(3)</A></STRONG>, <STRONG><A HREF="fsync.html">fsync(2)</A></STRONG>,
       <STRONG><A HREF="lseek.html">lseek(2)</A></STRONG>, <STRONG><A HREF="malloc.html">malloc(3)</A></STRONG>, <STRONG><A HREF="memcmp.html">memcmp(3)</A></STRONG>, <STRONG><A HREF="memcpy.html">memcpy(3)</A></STRONG>, <STRONG><A HREF="memset.html">memset(3)</A></STRONG>,
       <STRONG><A HREF="mmap.html">mmap(2)</A></STRONG>, <STRONG><A HREF="open.html">open(2)</A></STRONG>, <STRONG><A HREF="read.html">read(2)</A></STRONG>, <STRONG><A HREF="sigfillset.html">sigfillset(3)</A></STRONG>, <STRONG><A HREF="sigprocmask.html">sigprocmask(2)</A></STRONG>,
       <STRONG><A HREF="stat.html">stat(2)</A></STRONG>, <STRONG><A HREF="strcpy.html">strcpy(3)</A></STRONG>, <STRONG><A HREF="strdup.html">strdup(3)</A></STRONG>, <STRONG><A HREF="strerror.html">strerror(3)</A></STRONG>, <STRONG><A HREF="strlen.html">strlen(3)</A></STRONG>,
       <STRONG><A HREF="time.html">time(3)</A></STRONG>, <STRONG><A HREF="unlink.html">unlink(2)</A></STRONG>, and <STRONG><A HREF="write.html">write(2)</A></STRONG>.

       In addition, the  <EM>DbMpoolFile::get</EM>  method  may  fail  and
       throw  a  <STRONG><A HREF="DbException.html">DbException(3)</A></STRONG> or return <EM>errno</EM> for the following
       conditions:

       [EAGAIN]
            The  page  reference  count  has  overflowed.   (This
            should  never  happen unless there's a bug in the ap-
            plication.)

       [EINVAL]
            An invalid flag value or parameter was specified.

            The DB_MPOOL_NEW flag was set and the source file was
            not opened for writing.

            The requested page does not exist and DB_MPOOL_CREATE
            was not set.

            More than one of DB_MPOOL_CREATE,  DB_MPOOL_LAST  and
            DB_MPOOL_NEW was set.

       <STRONG><A HREF="unlink.html">unlink(2)</A></STRONG>, and <STRONG><A HREF="write.html">write(2)</A></STRONG>.

       In addition, the  <EM>DbMpoolFile::put</EM>  method  may  fail  and
       throw  a  <STRONG><A HREF="DbException.html">DbException(3)</A></STRONG> or return <EM>errno</EM> for the following
       conditions:

       [EACCES]
            The DB_MPOOL_DIRTY flag was set and the  source  file
            was not opened for writing.

       [EINVAL]
            An invalid flag value or parameter was specified.

            The  <EM>pgaddr</EM>  parameter  does not reference a page re-
            turned by <EM>DbMpoolFile::get</EM>.

            More than one of  DB_MPOOL_CLEAN  and  DB_MPOOL_DIRTY
            was set.

       The  <EM>DbMpoolFile::set</EM> method may fail and throw a <EM>DbExcep-</EM>
       <STRONG><A HREF="tion.html">tion(3)</A></STRONG> or return <EM>errno</EM> for any of  the  errors  specified
       for the following DB and library functions: <STRONG><A HREF="fcntl.html">fcntl(2)</A></STRONG>, and
       <STRONG><A HREF="fflush.html">fflush(3)</A></STRONG>.

       In addition, the  <EM>DbMpoolFile::set</EM>  method  may  fail  and
       throw  a  <STRONG><A HREF="DbException.html">DbException(3)</A></STRONG> or return <EM>errno</EM> for the following
       conditions:

       [EINVAL]
            An invalid flag value or parameter was specified.

       The <EM>DbMpoolFile::sync</EM> method may fail and throw a <EM>DbExcep-</EM>
       <STRONG><A HREF="tion.html">tion(3)</A></STRONG>  or  return  <EM>errno</EM> for any of the errors specified
       for the following DB and library functions:
       DBmemp-&gt;<STRONG><A HREF="pgin.html">pgin(3)</A></STRONG>, DBmemp-&gt;<STRONG><A HREF="pgout.html">pgout(3)</A></STRONG>, DbLog::<STRONG><A HREF="compare.html">compare(3)</A></STRONG>,
       DbLog::<STRONG><A HREF="flush.html">flush(3)</A></STRONG>, <STRONG><A HREF="close.html">close(2)</A></STRONG>, <STRONG><A HREF="fcntl.html">fcntl(2)</A></STRONG>, <STRONG><A HREF="fflush.html">fflush(3)</A></STRONG>, <STRONG><A HREF="fsync.html">fsync(2)</A></STRONG>,
       <STRONG><A HREF="lseek.html">lseek(2)</A></STRONG>, <STRONG><A HREF="malloc.html">malloc(3)</A></STRONG>, <STRONG><A HREF="memcpy.html">memcpy(3)</A></STRONG>, <STRONG><A HREF="memset.html">memset(3)</A></STRONG>, <STRONG><A HREF="open.html">open(2)</A></STRONG>,
       <STRONG><A HREF="qsort.html">qsort(3)</A></STRONG>, <STRONG><A HREF="realloc.html">realloc(3)</A></STRONG>, <STRONG><A HREF="sigfillset.html">sigfillset(3)</A></STRONG>, <STRONG><A HREF="sigprocmask.html">sigprocmask(2)</A></STRONG>,
       <STRONG><A HREF="stat.html">stat(2)</A></STRONG>, <STRONG><A HREF="strcpy.html">strcpy(3)</A></STRONG>, <STRONG><A HREF="strdup.html">strdup(3)</A></STRONG>, <STRONG><A HREF="strerror.html">strerror(3)</A></STRONG>, <STRONG><A HREF="strlen.html">strlen(3)</A></STRONG>,
       <STRONG><A HREF="unlink.html">unlink(2)</A></STRONG>, and <STRONG><A HREF="write.html">write(2)</A></STRONG>.



</PRE>
<H2>SEE ALSO</H2><PRE>
       <STRONG><A HREF="db_archive.html">db_archive(1)</A></STRONG>, <STRONG><A HREF="db_checkpoint.html">db_checkpoint(1)</A></STRONG>, <STRONG><A HREF="db_deadlock.html">db_deadlock(1)</A></STRONG>, <STRONG><A HREF="db_dump.html">db_dump(1)</A></STRONG>,
       <STRONG><A HREF="db_load.html">db_load(1)</A></STRONG>, <STRONG><A HREF="db_recover.html">db_recover(1)</A></STRONG>, <STRONG><A HREF="db_stat.html">db_stat(1)</A></STRONG>, <STRONG><A HREF="db_intro.html">db_intro(3)</A></STRONG>, <STRONG><A HREF="db_jump.html">db_jump(3)</A></STRONG>,
       <STRONG><A HREF="db_thread.html">db_thread(3)</A></STRONG>, <STRONG><A HREF="Db.html">Db(3)</A></STRONG>, <STRONG><A HREF="Dbc.html">Dbc(3)</A></STRONG>, <STRONG><A HREF="DbEnv.html">DbEnv(3)</A></STRONG>, <STRONG><A HREF="DbException.html">DbException(3)</A></STRONG>, <STRONG><A HREF="DbInfo.html">DbInfo(3)</A></STRONG>,
       <STRONG><A HREF="DbLock.html">DbLock(3)</A></STRONG>, <STRONG><A HREF="DbLocktab.html">DbLocktab(3)</A></STRONG>, <STRONG><A HREF="DbLog.html">DbLog(3)</A></STRONG>, <STRONG><A HREF="DbLsn.html">DbLsn(3)</A></STRONG>, <STRONG><A HREF="DbMpool.html">DbMpool(3)</A></STRONG>,
       <STRONG><A HREF="DbMpoolFile.html">DbMpoolFile(3)</A></STRONG>, <STRONG><A HREF="Dbt.html">Dbt(3)</A></STRONG>, <STRONG><A HREF="DbTxn.html">DbTxn(3)</A></STRONG>, <STRONG><A HREF="DbTxnMgr.html">DbTxnMgr(3)</A></STRONG>
</PRE>
</BODY>
</HTML>
