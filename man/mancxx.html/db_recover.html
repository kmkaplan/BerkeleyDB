<HTML>
<HEAD>
<TITLE>db_recover</TITLE>
</HEAD>
<BODY>
<H1>db_recover</H1>
<HR>
<PRE>

</PRE>
<H2>NAME</H2><PRE>
       db_recover - the DB database recovery utility


</PRE>
<H2>SYNOPSIS</H2><PRE>
       <STRONG>db_recover</STRONG> [<STRONG>-cv</STRONG>] [<STRONG>-h</STRONG> <STRONG>home</STRONG>]


</PRE>
<H2>DESCRIPTION</H2><PRE>
       The  <EM>db</EM><STRONG>_</STRONG><EM>recover</EM>  utility  must  be run after an unexpected
       application, DB, or system failure to restore the database
       to  a  consistent  state.   All committed transactions are
       guaranteed to appear after <EM>db</EM><STRONG>_</STRONG><EM>recover</EM>  has  run,  and  all
       uncommitted transactions will be completely undone.

       The options are as follows:

       <STRONG>-c</STRONG>   Failure was catastrophic.

       <STRONG>-h</STRONG>   Specify a home directory for the database.

       <STRONG>-v</STRONG>   Run in verbose mode.

       In  the case of catastrophic failure, an archival copy, or
       ``snapshot'' of all database files must be restored  along
       with  all of the log files written since the database file
       snapshot was made.  (If disk space is a problem, log files
       may  be referenced by symbolic links).  For further infor-
       mation on creating a database snapshot, see ``DB  ARCHIVAL
       PROCEDURES'' in <STRONG><A HREF="db_archive.html">db_archive(1)</A></STRONG>.

       If  the failure was not catastrophic, the files present on
       the system at the time of failure are sufficient  to  per-
       form recovery.

       If  log  files  are  missing, <EM>db</EM><STRONG>_</STRONG><EM>recover</EM> will identify the
       missing log file(s) and fail, in which  case  the  missing
       log  files  need  to  be  restored  and recovery performed
       again.

       The  <EM>db</EM><STRONG>_</STRONG><EM>recover</EM>  utility  attaches  to  DB  shared  memory
       regions.   In  order to avoid region corruption, it should
       always be given the chance to detach and exit  gracefully.
       To  cause  <EM>db</EM><STRONG>_</STRONG><EM>recover</EM>  to  clean up after itself and exit,
       send it an interrupt signal (SIGINT).

       The <EM>db</EM><STRONG>_</STRONG><EM>recover</EM> utility exits 0 on success, and  &gt;0  if  an
       error occurs.


</PRE>
<H2>FILESYSTEM OPERATIONS</H2><PRE>
       <STRONG>Filesystem</STRONG>  <STRONG>operations,</STRONG> <STRONG>e.g.,</STRONG> <STRONG>moving</STRONG> <STRONG>the</STRONG> <STRONG>database</STRONG> <STRONG>environ-</STRONG>
       <STRONG>ment</STRONG> <STRONG>to</STRONG> <STRONG>a</STRONG> <STRONG>different</STRONG> <STRONG>machine</STRONG> <STRONG>or</STRONG> <STRONG>file</STRONG> <STRONG>creation,</STRONG> <STRONG>deletion</STRONG>  <STRONG>or</STRONG>
       <STRONG>renaming,</STRONG>  <STRONG>cannot</STRONG> <STRONG>be</STRONG> <STRONG>transaction</STRONG> <STRONG>protected.</STRONG>  For this rea-
       son, <EM>db</EM><STRONG>_</STRONG><EM>recover</EM> cannot re-create, delete or  rename  files
       as part of recovery.

       <STRONG>db_recover</STRONG> <STRONG>must</STRONG> <STRONG>be</STRONG> <STRONG>rerun.</STRONG>

       Generally, it is simplest to perform filesystem operations
       at the same time as making a snapshot of the database.  To
       perform filesystem operations:

              1.   Cleanly shutdown database operations.
              2.   Rename, create or delete files.
              3.   Make a snapshot of the database.
              4.   Restart database applications.

       To cleanly shutdown database operations, all  applications
       accessing  the  database environment must be shutdown.  If
       the applications are not implemented such that they can be
       shutdown  gracefully  (i.e., closing all references to the
       database environment), <EM>db</EM><STRONG>_</STRONG><EM>recover</EM> must be  run  after  all
       applications  have been killed to ensure that the underly-
       ing database is consistent and flushed to disk.


</PRE>
<H2>RECOVERY</H2><PRE>
       After an application or system failure, there are two pos-
       sible  approaches  to  database  recovery.  If there is no
       need to retain state across the failure, and all databases
       can  be started anew, the database home directory can sim-
       ply be removed and  recreated.   If  it  is  necessary  to
       retain   persistent   state   across  failures,  then  the
       <STRONG><A HREF="db_recover.html">db_recover(1)</A></STRONG> utility should be run for each  DB  applica-
       tion environment, i.e., each database home directory.

       The  <EM>db</EM><STRONG>_</STRONG><EM>recover</EM> utility will remove all the shared regions
       (which may have been corrupted by the failure),  establish
       the  end of the log by identifying the last record written
       to  the  log,  and  then  perform  transaction   recovery.
       Database applications must not be restarted until recovery
       completes.  During transaction recovery, all changes  made
       by aborted transactions are undone and all changes made by
       committed transactions are redone,  as  necessary.   After
       recovery  runs, the environment is properly initialized so
       that applications may be restarted.  Any time an  applica-
       tion crashes or the system fails, <EM>db</EM><STRONG>_</STRONG><EM>recover</EM> should be run
       on any exiting database environments.

       Additionally, there are  two  forms  of  recovery:  normal
       recovery   and  catastrophic  recovery.   The  DB  package
       defines catastrophic failure to be  failure  where  either
       the database or log files have been destroyed or corrupted
       from the point of view of the  filesystem.   For  example,
       catastrophic  failure  includes  the  case  where the disk
       drive on which either the database or logs are stored  has
       crashed,  or  when  filesystem recovery is unable to bring
       the database and log files  to  a  consistent  state  with
       respect  to  the filesystem.  If the failure is non-catas-
       trophic, i.e., the database files and log  are  accessible
       on  a  filesystem  that  has recovered cleanly, <EM>db</EM><STRONG>_</STRONG><EM>recover</EM>


</PRE>
<H2>ENVIRONMENT VARIABLES</H2><PRE>
       The following environment variables affect  the  execution
       of <EM>db</EM><STRONG>_</STRONG><EM>recover</EM>:

       DB_HOME
            If the <STRONG>-h</STRONG> option is not specified and the environment
            variable <EM>DB</EM><STRONG>_</STRONG><EM>HOME</EM> is set, it is used as  the  path  of
            the database home, as described in <STRONG><A HREF="db_appinit.html">db_appinit(3)</A></STRONG>.


</PRE>
<H2>BUGS</H2><PRE>
       Future  versions of DB are expected to remove the restric-
       tion that database files must be manually  created  before
       recovery is performed.


</PRE>
<H2>SEE ALSO</H2><PRE>
       The  DB  library  is  a family of groups of functions that
       provides a modular programming interface  to  transactions
       and  record-oriented  file  access.   The library includes
       support for transactions, locking, logging and  file  page
       caching,  as well as various indexed access methods.  Many
       of the functional groups  (e.g.,  the  file  page  caching
       functions)  are  useful  independent of the other DB func-
       tions, although  some  functional  groups  are  explicitly
       based  on  other functional groups (e.g., transactions and
       logging).  For a general description of  the  DB  package,
       see <STRONG><A HREF="db_intro.html">db_intro(3)</A></STRONG>.

       <STRONG><A HREF="db_archive.html">db_archive(1)</A></STRONG>, <STRONG><A HREF="db_checkpoint.html">db_checkpoint(1)</A></STRONG>, <STRONG><A HREF="db_deadlock.html">db_deadlock(1)</A></STRONG>, <STRONG><A HREF="db_dump.html">db_dump(1)</A></STRONG>,
       <STRONG><A HREF="db_load.html">db_load(1)</A></STRONG>, <STRONG><A HREF="db_recover.html">db_recover(1)</A></STRONG>, <STRONG><A HREF="db_stat.html">db_stat(1)</A></STRONG>, <STRONG><A HREF="db_intro.html">db_intro(3)</A></STRONG>,
       <STRONG><A HREF="db_appinit.html">db_appinit(3)</A></STRONG>, <STRONG><A HREF="db_cursor.html">db_cursor(3)</A></STRONG>, <STRONG><A HREF="db_dbm.html">db_dbm(3)</A></STRONG>, <STRONG><A HREF="db_jump.html">db_jump(3)</A></STRONG>, <STRONG><A HREF="db_lock.html">db_lock(3)</A></STRONG>,
       <STRONG><A HREF="db_log.html">db_log(3)</A></STRONG>, <STRONG><A HREF="db_mpool.html">db_mpool(3)</A></STRONG>, <STRONG><A HREF="db_open.html">db_open(3)</A></STRONG>, <STRONG><A HREF="db_thread.html">db_thread(3)</A></STRONG>, <STRONG><A HREF="db_txn.html">db_txn(3)</A></STRONG>
</PRE>
</BODY>
</HTML>
