<!--$Id: env.so,v 1.1 2002/11/06 22:38:25 bostic Exp $-->
<!--Copyright 1997-2003 by Sleepycat Software, Inc.-->
<!--All rights reserved.-->
<!--See the file LICENSE for redistribution information.-->
<html>
<head>
<title>Berkeley DB Reference Guide: Environments</title>
<meta name="description" content="Berkeley DB: An embedded database programmatic toolkit.">
<meta name="keywords" content="embedded,database,programmatic,toolkit,b+tree,btree,hash,hashing,transaction,transactions,locking,logging,access method,access methods,Java,C,C++">
</head>
<body bgcolor=white>
<table width="100%"><tr valign=top>
<td><h3><dl><dt>Berkeley DB Reference Guide:<dd>Berkeley DB XML</dl></h3></td>
<td align=right><a href="../../ref/xml/documents.html"><img src="../../images/prev.gif" alt="Prev"></a><a href="../../reftoc.html"><img src="../../images/ref.gif" alt="Ref"></a><a href="../../ref/xml/index.html"><img src="../../images/next.gif" alt="Next"></a>
</td></tr></table>
<p>
<h3 align=center>Environments</h3>
<p>The client application can optionally associate a Berkeley DB Environment with
each container. The Berkeley DB environment offers transaction and resource
management functionality, and allows the client application to operate
on both XML containers and Berkeley DB databases in the context of a single
transaction. </p>
<p>The following figure illustrates the XML container structure, and its
relationship to a Berkeley DB Environment and Berkeley DB databases:</p>
<p align=center><img src="xml_fig_2.gif" alt="xml_fig_2">
<p>The following code example demonstrates how to manipulate containers
and documents within a Berkeley DB transaction and environment.</p>
<blockquote><pre>void example()
{
	// Create and open a Berkeley DB environment.
	DbEnv environment(0);
	environment.open(0, DB_CREATE|DB_INIT_LOCK|DB_INIT_LOG|DB_INIT_MPOOL|DB_INIT_TXN,0);
<p>
	// Create a Berkeley DB transaction.
	DbTxn *txn;
	environment.txn_begin(0,&txn,0);
<p>
	// Create and open a DB XML container within the environment.
	XmlContainer container(&environment,"test.dbxml");
	container.open(txn,DB_CREATE);
	try
	{
		// Insert a document into the container.
		XmlDocument document;
		std::string content("&lt;book&gt;&lt;title&gt;DB&lt;/title&gt;&lt;/book&gt;");
		document.setContent(content);
		container.putDocument(txn,document);
		txn-&gt;commit(0); // Commit the transaction
	}
	catch(DbException &e)
	{
		txn-&gt;abort(); // Abort the transaction
	}
	catch(exception &e)
	{
		txn-&gt;abort(); // Abort the transaction
	}
	container.close();
	environment.close(0);
}</pre></blockquote>
<p>As a convenience, a container can be configured to automatically
transact all update operations when it is opened. All container methods
that update the container will create and commit a Berkeley DB transaction if
the calling application does not provide one.  The following code
example illustrates how to open a container in this mode:</p>
<blockquote><pre>void example()
{
	// Create and open a Berkeley DB environment.
	DbEnv environment(0);
	environment.open(0, DB_CREATE|DB_INIT_LOCK|DB_INIT_LOG|DB_INIT_MPOOL|DB_INIT_TXN,0);
<p>
	// Create and open a DB XML container, specifying Auto Commit
	XmlContainer container(&environment,"test.dbxml");
	container.open(0,DB_CREATE|DB_AUTO_COMMIT);
<p>
	// Insert a document into the container.
	XmlDocument document;
	std::string content("&lt;book&gt;&lt;title&gt;DB&lt;/title&gt;&lt;/book&gt;");
	document.setContent(content);
	container.putDocument(0,document);
	container.close();
	environment.close(0);
}</pre></blockquote>
<table width="100%"><tr><td><br></td><td align=right><a href="../../ref/xml/documents.html"><img src="../../images/prev.gif" alt="Prev"></a><a href="../../reftoc.html"><img src="../../images/ref.gif" alt="Ref"></a><a href="../../ref/xml/index.html"><img src="../../images/next.gif" alt="Next"></a>
</td></tr></table>
<p><font size=1><a href="../../sleepycat/legal.html">Copyright (c) 1996-2003</a> <a href="http://www.sleepycat.com">Sleepycat Software, Inc.</a> - All rights reserved.</font>
</body>
</html>
